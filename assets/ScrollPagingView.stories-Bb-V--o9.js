import{L as F,g as I}from"./ListItem-CEvH25Hn.js";import{z as V,h,u as c,J as L,Y as R,n as P,a0 as N,R as E,Q as D,f as g,U as O,r as w,c as S,V as x,G as C}from"./vue.esm-bundler-FW-u_CMv.js";import{u as z}from"./index-BFK5Nhkc.js";import{K as H}from"./KxButton-BYZx_vn4.js";import{L as T}from"./LoadingStatus-C2v3_iFq.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BeRudJ4f.js";import"./AtomSpinner-BE_QQ1OP.js";var a=(e=>(e[e.FREE=0]="FREE",e[e.LOADING=1]="LOADING",e[e.FAILED=2]="FAILED",e[e.ALL_LOADED=3]="ALL_LOADED",e))(a||{});const M={key:0,class:"minor-text"},A=V({__name:"ScrollPager",props:{activeHeight:{default:512},autoLoad:{type:Boolean,default:!1},state:{},nextUrl:{}},emits:["loadPage"],setup(e,{emit:u}){const i=e,s=u;function d(){switch(i.state){case a.ALL_LOADED:case a.LOADING:return;default:s("loadPage")}}const l=z(n=>{n[0].isIntersecting&&i.autoLoad&&i.state===a.FREE&&d()},{rootMargin:i.activeHeight+"px"});return(n,p)=>(g(),h("div",{class:P(n.$style.container),ref:c(l)},[n.state===c(a).FREE?(g(),L(H,{key:0,class:P(n.$style.button),href:n.nextUrl,onClick:N(d,["prevent"])},{default:R(()=>p[0]||(p[0]=[O(" 查看更多 ")])),_:1},8,["class","href"])):E("",!0),D(n.$slots,"state",{},()=>[n.state===c(a).ALL_LOADED?(g(),h("span",M," 没有更多的了 ")):n.state!==c(a).FREE?(g(),L(T,{key:1,error:n.state===c(a).FAILED,onRetry:d},null,8,["error"])):E("",!0)])],2))}}),G="A80Ih",K="_1LlCr",U={"line-clamp":"-orqV",container:G,button:K},$={$style:U},j=B(A,[["__cssModules",$]]);A.__docgenInfo={exportName:"default",displayName:"ScrollPager",type:1,props:[{name:"activeHeight",global:!1,description:"滚动到距离底部还有多高时触发加载事件",tags:[],required:!1,type:"number | undefined",declarations:[],schema:{kind:"enum",type:"number | undefined",schema:["undefined","number"]},default:"512"},{name:"autoLoad",global:!1,description:"滚动时自动加载，该选项为 false 时将不触发滚动加载",tags:[],required:!1,type:"boolean | undefined",declarations:[],schema:{kind:"enum",type:"boolean | undefined",schema:["undefined","false","true"]},default:"false"},{name:"state",global:!1,description:"当前的状态",tags:[],required:!0,type:"State",declarations:[],schema:{kind:"enum",type:"State",schema:["State.FREE","State.LOADING","State.FAILED","State.ALL_LOADED"]}},{name:"nextUrl",global:!1,description:"用于预渲染，也能够让爬虫跟踪到后续页",tags:[],required:!1,type:"string | undefined",declarations:[],schema:{kind:"enum",type:"string | undefined",schema:["undefined","string"]}},{name:"key",global:!0,description:"",tags:[],required:!1,type:"PropertyKey | undefined",declarations:[],schema:{kind:"enum",type:"PropertyKey | undefined",schema:["undefined","string","number","symbol"]}},{name:"ref",global:!0,description:"",tags:[],required:!1,type:"VNodeRef | undefined",declarations:[],schema:{kind:"enum",type:"VNodeRef | undefined",schema:["undefined","string","Ref<any, any>",{kind:"event",type:"(ref: Element | ComponentPublicInstance<{}, {}, {}, {}, {}, {}, {}, {}, false, ComponentOptionsBase<any, any, any, any, any, any, any, any, any, {}, {}, string, {}, {}, {}, string, ComponentProvideOptions>, ... 4 more ..., any> | null, refs: Record<...>): void"}]}},{name:"ref_for",global:!0,description:"",tags:[],required:!1,type:"boolean | undefined",declarations:[],schema:{kind:"enum",type:"boolean | undefined",schema:["undefined","false","true"]}},{name:"ref_key",global:!0,description:"",tags:[],required:!1,type:"string | undefined",declarations:[],schema:{kind:"enum",type:"string | undefined",schema:["undefined","string"]}},{name:"class",global:!0,description:"",tags:[],required:!1,type:"unknown",declarations:[],schema:"unknown"},{name:"style",global:!0,description:"",tags:[],required:!1,type:"unknown",declarations:[],schema:"unknown"}],events:[{name:"loadPage",description:"",tags:[],type:"any[]",signature:'(event: "loadPage", ...args: any[]): void',declarations:[],schema:["any"]}],slots:[{name:"state",type:"{}",description:"",declarations:[],schema:{kind:"object",type:"{}"}}],exposed:[{name:"activeHeight",type:"number",description:"滚动到距离底部还有多高时触发加载事件",declarations:[],schema:"number"},{name:"autoLoad",type:"boolean",description:"滚动时自动加载，该选项为 false 时将不触发滚动加载",declarations:[],schema:{kind:"enum",type:"boolean",schema:["false","true"]}},{name:"state",type:"State",description:"当前的状态",declarations:[],schema:{kind:"enum",type:"State",schema:["State.FREE","State.LOADING","State.FAILED","State.ALL_LOADED"]}},{name:"nextUrl",type:"string | undefined",description:"用于预渲染，也能够让爬虫跟踪到后续页",declarations:[],schema:{kind:"enum",type:"string | undefined",schema:["undefined","string"]}}],sourceFiles:"/home/runner/work/uikit/uikit/src/paging/ScrollPager.vue"};const b=V({__name:"ScrollPagingView",props:{modelValue:{},autoLoad:{type:Boolean},activeHeight:{},start:{default:0},pageSize:{default:16},loader:{},nextLink:{}},emits:["update:modelValue"],setup(e,{expose:u,emit:i}){const s=e,d=i,l=w(a.FREE),n=w(s.modelValue.items.length),p=S(()=>{const{start:t,modelValue:o}=s;return t+n.value>=o.total}),_=S(()=>{const{start:t,pageSize:o,nextLink:r}=s;if(!(p.value||!r))return r(t+n.value,o)});async function k(t){const{loader:o,pageSize:r}=s,{signal:y}=new AbortController;l.value=a.LOADING;try{const m=await o(t,r,y);return l.value=a.FREE,m}catch(m){l.value=a.FAILED,console.error("[ScrollPagingView] 数据加载失败",m)}}async function q(){const{start:t,pageSize:o}=s,r=await k(t);r&&(n.value=o,d("update:modelValue",r))}async function v(){const{start:t,modelValue:o,pageSize:r}=s,{items:y}=o,m=await k(t+n.value);m&&(n.value+=r,d("update:modelValue",{total:m.total,items:y.concat(m.items)}))}return u({reload:q,loadNext:v}),(t,o)=>(g(),h(C,null,[D(t.$slots,"default",{items:t.modelValue.items}),x(j,{state:p.value?c(a).ALL_LOADED:l.value,"auto-load":t.autoLoad,"next-url":_.value,"active-height":t.activeHeight,onLoadPage:v},null,8,["state","auto-load","next-url","active-height"])],64))}});b.__docgenInfo={exportName:"default",displayName:"ScrollPagingView",type:1,props:[{name:"modelValue",global:!1,description:"",tags:[],required:!0,type:"PageData",declarations:[],schema:{kind:"object",type:"PageData"}},{name:"autoLoad",global:!1,description:"是否触发滚动加载，不使用的话就显示个加载按钮。",tags:[],required:!0,type:"boolean",declarations:[],schema:{kind:"enum",type:"boolean",schema:["false","true"]}},{name:"activeHeight",global:!1,description:"",tags:[],required:!1,type:"number | undefined",declarations:[],schema:{kind:"enum",type:"number | undefined",schema:["undefined","number"]}},{name:"start",global:!1,description:"初始偏移，不包括已有的元素数量。",tags:[],required:!1,type:"number | undefined",declarations:[],schema:{kind:"enum",type:"number | undefined",schema:["undefined","number"]},default:"0"},{name:"pageSize",global:!1,description:"",tags:[],required:!1,type:"number",declarations:[],schema:"number",default:"16"},{name:"loader",global:!1,description:"",tags:[],required:!0,type:"LoadDateFn",declarations:[],schema:{kind:"event",type:"(start: number, count: number, signal: AbortSignal): Promise<PageData>"}},{name:"nextLink",global:!1,description:"下一页的链接，用于 SSR，如果不存在则不生成。",tags:[],required:!1,type:"PageLinkFn | undefined",declarations:[],schema:{kind:"enum",type:"PageLinkFn | undefined",schema:["undefined",{kind:"event",type:"(start: number, count: number): string"}]}},{name:"key",global:!0,description:"",tags:[],required:!1,type:"PropertyKey | undefined",declarations:[],schema:{kind:"enum",type:"PropertyKey | undefined",schema:["undefined","string","number","symbol"]}},{name:"ref",global:!0,description:"",tags:[],required:!1,type:"VNodeRef | undefined",declarations:[],schema:{kind:"enum",type:"VNodeRef | undefined",schema:["undefined","string","Ref<any, any>",{kind:"event",type:"(ref: Element | ComponentPublicInstance<{}, {}, {}, {}, {}, {}, {}, {}, false, ComponentOptionsBase<any, any, any, any, any, any, any, any, any, {}, {}, string, {}, {}, {}, string, ComponentProvideOptions>, ... 4 more ..., any> | null, refs: Record<...>): void"}]}},{name:"ref_for",global:!0,description:"",tags:[],required:!1,type:"boolean | undefined",declarations:[],schema:{kind:"enum",type:"boolean | undefined",schema:["undefined","false","true"]}},{name:"ref_key",global:!0,description:"",tags:[],required:!1,type:"string | undefined",declarations:[],schema:{kind:"enum",type:"string | undefined",schema:["undefined","string"]}},{name:"class",global:!0,description:"",tags:[],required:!1,type:"unknown",declarations:[],schema:"unknown"},{name:"style",global:!0,description:"",tags:[],required:!1,type:"unknown",declarations:[],schema:"unknown"}],events:[{name:"update:modelValue",description:"",tags:[],type:"any[]",signature:'(event: "update:modelValue", ...args: any[]): void',declarations:[],schema:["any"]}],slots:[{name:"default",type:"{ items: unknown[]; }",description:"",declarations:[],schema:{kind:"object",type:"{ items: unknown[]; }"}}],exposed:[{name:"start",type:"number",description:"初始偏移，不包括已有的元素数量。",declarations:[],schema:"number"},{name:"pageSize",type:"number",description:"",declarations:[],schema:"number"},{name:"modelValue",type:"PageData",description:"",declarations:[],schema:{kind:"object",type:"PageData"}},{name:"loader",type:"LoadDateFn",description:"",declarations:[],schema:{kind:"event",type:"(start: number, count: number, signal: AbortSignal): Promise<PageData>"}},{name:"nextLink",type:"PageLinkFn | undefined",description:"下一页的链接，用于 SSR，如果不存在则不生成。",declarations:[],schema:{kind:"enum",type:"PageLinkFn | undefined",schema:["undefined",{kind:"event",type:"(start: number, count: number): string"}]}},{name:"activeHeight",type:"number | undefined",description:"",declarations:[],schema:{kind:"enum",type:"number | undefined",schema:["undefined","number"]}},{name:"autoLoad",type:"boolean",description:"是否触发滚动加载，不使用的话就显示个加载按钮。",declarations:[],schema:{kind:"enum",type:"boolean",schema:["false","true"]}},{name:"reload",type:"() => Promise<void>",description:"",declarations:[],schema:{kind:"event",type:"(): Promise<void>"}},{name:"loadNext",type:"() => Promise<void>",description:"",declarations:[],schema:{kind:"event",type:"(): Promise<void>"}}],sourceFiles:"/home/runner/work/uikit/uikit/src/paging/ScrollPagingView.vue"};const te={component:b,args:{total:1e3,mockErrorAt:1/0,autoLoad:!1,start:0,pageSize:20,activeHeight:200},argTypes:{mockErrorAt:{control:{type:"number"}},total:{control:{type:"number"}}}},f=e=>({components:{ListItem:F,ScrollPagingView:b},template:`
        <ScrollPagingView
            v-bind="binding"
            v-model="model"
            :loader="load"
        >
            <template v-slot="{ items }">
                <ListItem v-for="v in items" :key="v.id" v-bind="v"/>
            </template>
        </ScrollPagingView>
    `,data(){const{total:u,...i}=e;return{loadTimes:0,binding:i,model:{total:u,items:[]}}},methods:{async load(u,i){if(this.loadTimes>=e.mockErrorAt)throw new Error("Mocked Error");await new Promise(l=>setTimeout(l,1e3));const{total:s}=e,d=Math.min(s-u,i);return this.loadTimes++,{total:s,items:I(d)}}}});f.parameters={...f.parameters,docs:{...f.parameters?.docs,source:{originalSource:`args => ({
  components: {
    ListItem,
    ScrollPagingView: ScrollPagingViewVue
  },
  template: \`
        <ScrollPagingView
            v-bind="binding"
            v-model="model"
            :loader="load"
        >
            <template v-slot="{ items }">
                <ListItem v-for="v in items" :key="v.id" v-bind="v"/>
            </template>
        </ScrollPagingView>
    \`,
  data() {
    const {
      total,
      ...binding
    } = args;
    return {
      loadTimes: 0,
      binding,
      model: {
        total,
        items: []
      }
    };
  },
  methods: {
    async load(start: number, size: number) {
      if (this.loadTimes >= args.mockErrorAt) {
        throw new Error("Mocked Error");
      }
      await new Promise(resolve => setTimeout(resolve, 1000));
      const {
        total
      } = args;
      const count = Math.min(total - start, size);
      this.loadTimes++;
      return {
        total,
        items: getQuotes(count)
      };
    }
  }
})`,...f.parameters?.docs?.source}}};const ae=["ScrollPagingView"];export{f as ScrollPagingView,ae as __namedExportsOrder,te as default};
