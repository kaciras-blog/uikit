import{w as v,z as b,D as E,E as C,h as D,F as A,u as g,G as L,f as w,H as q,I as x,J as I,K as N,L as O}from"./vue.esm-bundler-FW-u_CMv.js";import{n as P,i as R,t as k,a as B,b as F}from"./index-BeRudJ4f.js";import{u as K}from"./LRUCache-nrA0TT2c.js";import{u as V,D as _}from"./quick-alert-BR3-N5_h.js";const G=B?window:void 0;function M(l){var s;const o=k(l);return(s=o?.$el)!=null?s:o}function S(...l){let s,o,r,c;if(typeof l[0]=="string"||Array.isArray(l[0])?([o,r,c]=l,s=G):[s,o,r,c]=l,!s)return P;Array.isArray(o)||(o=[o]),Array.isArray(r)||(r=[r]);const u=[],d=()=>{u.forEach(a=>a()),u.length=0},f=(a,e,t,n)=>(a.addEventListener(e,t,n),()=>a.removeEventListener(e,t,n)),m=v(()=>[M(s),k(c)],([a,e])=>{if(d(),!a)return;const t=R(e)?{...e}:e;u.push(...o.flatMap(n=>r.map(i=>f(a,n,i,t))))},{immediate:!0,flush:"post"}),p=()=>{m(),d()};return F(p),p}const y="__KX_DIALOG__",W=b({__name:"DialogContainer",setup(l){const s=E([]),o=new Map,r=typeof window>"u"?!1:window.innerWidth<768;function c(e,t){return t===s.length-1||e.component.isolation}function u(){const{flag:e,id:t}=history.state??{};if(e!==y)s.forEach(n=>f(n));else{const n=s.findIndex(i=>i.id===t);s.slice(n+1).forEach(i=>f(i))}}function d(e,t){const n=s.indexOf(e);n!==-1&&s.splice(n,1),e.resolve(t)}function f(e,t=_.CANCELED){if(e.closed)return;e.closed=!0;const{beforeDialogClose:n}=o.get(e.id);typeof n!="function"?d(e,t):Promise.resolve(n()).finally(()=>d(e,t))}function m(e){const t=K();if(e.id=t,s.push(e),r){const n={...history.state,flag:y,id:t};history.pushState(n,"")}}function p(e){const t=s.at(-1);if(!t)throw new Error("没有可关闭的弹窗");const{flag:n,id:i}=history.state??{};n===y&&i===t.id?history.back():f(t,e)}function a(){s.splice(0,s.length).forEach(e=>e.resolve(_.CANCELED))}return C(()=>o.clear()),r&&S(window,"popstate",u),V().connect({push:m,close:p,clear:a}),(e,t)=>(w(!0),D(L,null,A(g(s),(n,i)=>q((w(),I(O(n.component),N({key:n.id,ref_for:!0},n.props,{ref_for:!0,ref:h=>h&&g(o).set(n.id,h)}),null,16)),[[x,c(n,i)]])),128))}});W.__docgenInfo={exportName:"default",displayName:"DialogContainer",type:1,props:[{name:"key",global:!0,description:"",tags:[],required:!1,type:"PropertyKey | undefined",declarations:[],schema:{kind:"enum",type:"PropertyKey | undefined",schema:["undefined","string","number","symbol"]}},{name:"ref",global:!0,description:"",tags:[],required:!1,type:"VNodeRef | undefined",declarations:[],schema:{kind:"enum",type:"VNodeRef | undefined",schema:["undefined","string","Ref<any, any>",{kind:"event",type:"(ref: Element | ComponentPublicInstance<{}, {}, {}, {}, {}, {}, {}, {}, false, ComponentOptionsBase<any, any, any, any, any, any, any, any, any, {}, {}, string, {}, {}, {}, string, ComponentProvideOptions>, ... 4 more ..., any> | null, refs: Record<...>): void"}]}},{name:"ref_for",global:!0,description:"",tags:[],required:!1,type:"boolean | undefined",declarations:[],schema:{kind:"enum",type:"boolean | undefined",schema:["undefined","false","true"]}},{name:"ref_key",global:!0,description:"",tags:[],required:!1,type:"string | undefined",declarations:[],schema:{kind:"enum",type:"string | undefined",schema:["undefined","string"]}},{name:"class",global:!0,description:"",tags:[],required:!1,type:"unknown",declarations:[],schema:"unknown"},{name:"style",global:!0,description:"",tags:[],required:!1,type:"unknown",declarations:[],schema:"unknown"}],events:[],slots:[],exposed:[],sourceFiles:"/home/runner/work/uikit/uikit/src/dialog/DialogContainer.vue"};export{W as _};
